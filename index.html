<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate Translator App</title>
<style>
:root{
  --grad1:#ff6b6b;
  --grad2:#feca57;
  --grad3:#48dbfb;
  --grad4:#1dd1a1;
  --card:#1e293b;
  --text:#ffffff;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{
  font-family:"Segoe UI",Roboto,Arial,sans-serif;
  background:linear-gradient(135deg,var(--grad1),var(--grad2),var(--grad3),var(--grad4));
  color:var(--text);
  min-height:100vh;
}
header{padding:16px;text-align:center;}
.app-header{display:flex;align-items:center;justify-content:center;gap:12px;}
.app-icon{width:50px;height:50px;border-radius:12px;}
.app-title{font-size:26px;font-weight:700;}
.tabs{display:flex;margin:10px;}
.tabs button{flex:1;padding:12px;margin:2px;border:none;border-radius:12px;font-size:14px;cursor:pointer;transition:.3s;}
.tabs button.active{background:linear-gradient(135deg,#fff,#f1f2f6);color:#222;font-weight:700;}
.section{display:none;padding:16px;}
.section.active{display:block;}
.card{background:rgba(30,41,59,0.9);border-radius:16px;padding:16px;margin-bottom:16px;box-shadow:0 10px 25px rgba(0,0,0,.25);}
textarea,input,select{width:100%;padding:12px;margin:10px 0;border-radius:12px;border:none;font-size:16px;background:rgba(255,255,255,0.1);color:#fff;}
textarea{min-height:120px;}
.action{background:linear-gradient(135deg,#6c5ce7,#00cec9);border:none;padding:14px;border-radius:14px;font-size:18px;width:100%;color:white;cursor:pointer;margin-top:10px;}
#loader{position:fixed;inset:0;background:rgba(0,0,0,.75);display:none;align-items:center;justify-content:center;flex-direction:column;z-index:999;}
#emoji{font-size:60px;animation:bounce 1s infinite;}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-14px)}}
#progress{width:70%;height:8px;background:#444;border-radius:10px;margin-top:20px;overflow:hidden;}
#bar{height:100%;width:0%;background:linear-gradient(135deg,#6c5ce7,#00cec9);transition:width .4s;}
#loaderText{margin-top:14px;font-size:16px;}
textarea[readonly]{background:rgba(255,255,255,0.1);color:#fff;min-height:120px;font-size:16px;padding:10px;border-radius:12px;}
</style>
</head>
<body>

<header>
  <div class="app-header">
    <img class="app-icon" src="https://cdn-icons-png.flaticon.com/512/3898/3898082.png">
    <div class="app-title">Ultimate Translator</div>
  </div>
</header>

<div class="tabs">
  <button class="active" onclick="tab(0)">ğŸ“ Text â†’ Text</button>
  <button onclick="tab(1)">ğŸ“ Text â†’ Speech</button>
  <button onclick="tab(2)">ğŸ¤ Speech â†’ Text</button>
  <button onclick="tab(3)">ğŸ—£ Speech â†’ Speech</button>
</div>

<!-- Text â†’ Text -->
<div class="section active">
  <div class="card">
    <textarea id="textInputTT" placeholder="Type text here..."></textarea>
    <label>Source Language</label>
    <select id="fromLangTT"></select>
    <label>Target Language</label>
    <select id="toLangTT"></select>
    <button class="action" onclick="textToText()">ğŸŒ Translate</button>
    <textarea id="resultTextTT" readonly placeholder="Translated text will appear here..."></textarea>
    <button class="action" onclick="copyText('resultTextTT')">ğŸ“‹ Copy Text</button>
  </div>
</div>

<!-- Text â†’ Speech -->
<div class="section">
  <div class="card">
    <textarea id="textInputTS" placeholder="Type text here..."></textarea>
    <label>Source Language</label>
    <select id="fromLangTS"></select>
    <label>Target Language</label>
    <select id="toLangTS"></select>
    <button class="action" onclick="textToSpeech()">ğŸŒ Translate & Speak</button>
    <div id="resultTextTS"></div>
  </div>
</div>

<!-- Speech â†’ Text -->
<div class="section">
  <div class="card">
    <label>Source Language</label>
    <select id="fromLangSTT"></select>
    <label>Target Language</label>
    <select id="toLangSTT"></select>
    <button class="action" onclick="speechToText()">ğŸ¤ Speak & Translate</button>
    <textarea id="resultTextSTT" readonly placeholder="Translated text will appear here..."></textarea>
    <button class="action" onclick="copyText('resultTextSTT')">ğŸ“‹ Copy Text</button>
  </div>
</div>

<!-- Speech â†’ Speech -->
<div class="section">
  <div class="card">
    <label>Source Language</label>
    <select id="fromLangSTS"></select>
    <label>Target Language</label>
    <select id="toLangSTS"></select>
    <button class="action" onclick="speechToSpeech()">ğŸ¤ Speak & Translate to Voice</button>
    <div id="resultTextSTS"></div>
  </div>
</div>

<!-- Loader -->
<div id="loader">
  <div id="emoji">â³</div>
  <div id="progress"><div id="bar"></div></div>
  <div id="loaderText">Processing...</div>
</div>

<script>
const languages=[
["en","English"],["ar","Arabic"],["fr","French"],["es","Spanish"],
["de","German"],["it","Italian"],["pt","Portuguese"],["ru","Russian"],
["tr","Turkish"],["hi","Hindi"],["zh","Chinese"],["ja","Japanese"],
["ko","Korean"],["id","Indonesian"],["ur","Urdu"]
];

function fillSelects(){
  const selects=["fromLangTT","toLangTT","fromLangTS","toLangTS","fromLangSTT","toLangSTT","fromLangSTS","toLangSTS"];
  selects.forEach(id=>{
    const sel=document.getElementById(id);
    sel.innerHTML="";
    languages.forEach(l=>sel.innerHTML+=`<option value="${l[0]}">${l[1]}</option>`);
  });
  selects.forEach(id=>document.getElementById(id).value="en");
}
window.onload = fillSelects;

/* Tabs */
function tab(i){
  document.querySelectorAll(".section").forEach((s,n)=>s.classList.toggle("active",n===i));
  document.querySelectorAll(".tabs button").forEach((b,n)=>b.classList.toggle("active",n===i));
}

/* Loader */
function showLoader(text,emoji="â³",p=30){ loader.style.display="flex"; loaderText.textContent=text; document.getElementById("emoji").textContent=emoji; bar.style.width=p+"%";}
function hideLoader(){ loader.style.display="none"; bar.style.width="0%"; }

/* Copy Text */
function copyText(id){
  const txt=document.getElementById(id);
  txt.select();
  txt.setSelectionRange(0, 99999);
  document.execCommand("copy");
  alert("Text copied!");
}

/* Translate function - final working version */
async function translate(text,source,target){
  if(!text) return "";
  source = source || "en";
  target = target || "en";
  showLoader("ğŸ”„ Translating...","ğŸ”„",30);
  try{
    const res = await fetch("https://libretranslate.de/translate",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({q:text,source:source,target:target,format:"text"})
    });
    const data = await res.json();
    hideLoader();
    return data.translatedText;
  }catch(e){
    hideLoader();
    alert("Translation failed: "+e);
    return text;
  }
}

/* Text â†’ Text */
async function textToText(){
  const text=document.getElementById("textInputTT").value.trim();
  if(!text) return alert("Enter text!");
  const translated=await translate(text,document.getElementById("fromLangTT").value,document.getElementById("toLangTT").value);
  document.getElementById("resultTextTT").value=translated;
  navigator.clipboard.writeText(translated);
}

/* Text â†’ Speech */
async function textToSpeech(){
  const text=document.getElementById("textInputTS").value.trim();
  if(!text) return alert("Enter text!");
  const translated=await translate(text,document.getElementById("fromLangTS").value,document.getElementById("toLangTS").value);
  document.getElementById("resultTextTS").textContent=translated;
  speak(translated,document.getElementById("toLangTS").value);
}

/* Speech â†’ Text */
function speechToText(){
  const R=window.SpeechRecognition||webkitSpeechRecognition;
  if(!R) return alert("Speech recognition not supported");
  const r=new R();
  r.lang=document.getElementById("fromLangSTT").value;
  showLoader("ğŸ¤ Listening...","ğŸ¤",20);
  r.onresult=async e=>{
    const text=e.results[0][0].transcript;
    const translated=await translate(text,document.getElementById("fromLangSTT").value,document.getElementById("toLangSTT").value);
    document.getElementById("resultTextSTT").value=translated;
    navigator.clipboard.writeText(translated);
    hideLoader();
  };
  r.onerror=e=>{ hideLoader(); alert(e.error); }
  r.start();
}

/* Speech â†’ Speech */
function speechToSpeech(){
  const R=window.SpeechRecognition||webkitSpeechRecognition;
  if(!R) return alert("Speech recognition not supported");
  const r=new R();
  r.lang=document.getElementById("fromLangSTS").value;
  showLoader("ğŸ¤ Listening & Translating...","ğŸ¤",20);
  r.onresult=async e=>{
    const text=e.results[0][0].transcript;
    const translated=await translate(text,document.getElementById("fromLangSTS").value,document.getElementById("toLangSTS").value);
    document.getElementById("resultTextSTS").textContent=translated;
    speak(translated,document.getElementById("toLangSTS").value);
  };
  r.onerror=e=>{ hideLoader(); alert(e.error); }
  r.start();
}

/* Speech synthesis */
let synth=window.speechSynthesis,utter;
function speak(text,lang){
  showLoader("ğŸ”Š Speaking...","ğŸ—£ï¸",90);
  synth.cancel();
  utter=new SpeechSynthesisUtterance(text);
  utter.lang=lang;
  utter.onend=hideLoader;
  synth.speak(utter);
}
</script>
</body>
</html>